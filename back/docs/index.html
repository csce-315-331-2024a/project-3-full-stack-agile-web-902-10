<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>back</title><meta name="description" content="Documentation for back"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">back</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>back</h2></div><div class="tsd-panel tsd-typography"><a id="md:socket-io-backend" class="tsd-anchor"></a><h1><a href="#md:socket-io-backend">Socket IO Backend</a></h1><a id="md:preface" class="tsd-anchor"></a><h2><a href="#md:preface">Preface</a></h2><p>Instead of using the traditional REST api of even something like tRPC, 
the fastest and easiest method was WebSockets. We were already looking
into them for having client&#39;s be updated when the databse was modified.
However it turned out to be a very pleasant experience for even simple
data fetching.</p>
<a id="md:server-setup" class="tsd-anchor"></a><h2><a href="#md:server-setup">Server setup</a></h2><p>After insuring all the dependencies are installed,
run <code>npm run build</code> and <code>npm run start</code>, this will
build and run the server.</p>
<a id="md:sending-data-to-the-server" class="tsd-anchor"></a><h2><a href="#md:sending-data-to-the-server">Sending data to the server</a></h2><p>You can send data to the server by emitting events. For instance, to 
create a new ingredient or log in a user, you would emit respective 
events as defined on the server:</p>
<pre><code class="language-ts"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">auth</span><span class="hl-1">: </span><span class="hl-3">AuthPacket</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">email:</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">?.</span><span class="hl-4">email</span><span class="hl-1"> ?? </span><span class="hl-5">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">jwt:</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">?.</span><span class="hl-4">jwt</span><span class="hl-1"> ?? </span><span class="hl-5">&quot;&quot;</span><br/><span class="hl-1">};</span><br/><span class="hl-1">    </span><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-6">deleteItem</span><span class="hl-1">(</span><span class="hl-4">menu_item</span><span class="hl-1">: </span><span class="hl-3">Menu_Item</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">update_query</span><span class="hl-1">: </span><span class="hl-3">MenuItemDelete</span><span class="hl-1"> = {</span><br/><span class="hl-1">        </span><span class="hl-4">where:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">menu_item</span><span class="hl-1">.</span><span class="hl-4">id</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">?.</span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-5">&#39;menuItem:delete&#39;</span><span class="hl-1">, </span><span class="hl-4">auth</span><span class="hl-1">, </span><span class="hl-4">update_query</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:to-listen-to-updates-on-the-database-and-update-locally" class="tsd-anchor"></a><h2><a href="#md:to-listen-to-updates-on-the-database-and-update-locally">To listen to updates on the database and update locally</a></h2><p>The server sends events like Menu_Item, Ingredient, which you 
need to listen for:</p>
<pre><code class="language-ts"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">socket</span><span class="hl-1"> = </span><span class="hl-6">useSocket</span><span class="hl-1">();</span><br/><span class="hl-6">useEffect</span><span class="hl-1">(() </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-4">socket</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-8">// Read in menuItems on page mount. &quot;undefined&quot; because we have no need for query during read all.</span><br/><span class="hl-1">        </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-5">&quot;menuItem:read&quot;</span><span class="hl-1">, </span><span class="hl-0">undefined</span><span class="hl-1">, (</span><span class="hl-4">new_menu_items</span><span class="hl-1">: </span><span class="hl-3">Menu_Item</span><span class="hl-1">[]) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">setMenuItems</span><span class="hl-1">(</span><span class="hl-4">new_menu_items</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-8">// Listen to changes and update</span><br/><span class="hl-1">        </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;menuItem&quot;</span><span class="hl-1">, (</span><span class="hl-4">new_menu_items</span><span class="hl-1">: </span><span class="hl-3">Menu_Item</span><span class="hl-1">[]) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">setMenuItems</span><span class="hl-1">(</span><span class="hl-4">new_menu_items</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}, [</span><span class="hl-4">socket</span><span class="hl-1">]);</span>
</code><button>Copy</button></pre>
<a id="md:example-code" class="tsd-anchor"></a><h2><a href="#md:example-code">Example Code</a></h2><p>app/menu integrates exsiting prisma code from the Server Sided Render, and uses that
to initially server the user, once loaded though it listens to changes from the database
and updates accordingly</p>
<a id="md:clarifying-stuff-up" class="tsd-anchor"></a><h2><a href="#md:clarifying-stuff-up">Clarifying stuff up</a></h2><ol>
<li>Why do we need to use useEffect?
 The client socket might not be available at all times,
 to insure no buggy reads, we wrap it in a useEffect.</li>
<li>Notice that the user session info is initialiy recovered
 from the server, this is cause next-auth does not pass
 any useful information to the client, so we need to get
 it ourselfves and pass it to the client. During the creation
 of the JWT (Java Web Token) another token is created and placed
 on in the database, this token is used to authorize users to do
 more restrictive CRUD operations.</li>
</ol>
<a id="md:refrence" class="tsd-anchor"></a><h2><a href="#md:refrence">Refrence</a></h2><p>Here are all the functions that the client can call to the server,
note that any time a modification is made, the server makes a brodcast
back to all clients that are listening to the corresponding table.</p>
<pre><code class="language-ts"><span class="hl-4">io</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;connect&quot;</span><span class="hl-1">, (</span><span class="hl-4">socket</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;ingredient:create&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">ingredientCreate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;ingredient:read&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">ingredientRead</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;ingredient:update&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">ingredientUpdate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;ingredient:delete&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">ingredientDelete</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;ingredientMenu:create&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">ingredientsMenuCreate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;ingredientMenu:read&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">ingredientsMenuRead</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;ingredientMenu:update&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">ingredientsMenuUpdate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;ingredientMenu:delete&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">ingredientsMenuDelete</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;loginLog:create&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">loginLogCreate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;loginLog:read&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">loginLogRead</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;loginLog:update&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">loginLogUpdate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;loginLog:delete&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">loginLogDelete</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;menuItem:create&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">menuItemCreate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;menuItem:add&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">menuItemAdd</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;menuItem:read&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">menuItemRead</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;menuItem:update&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">menuItemUpdate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;menuItem:delete&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">menuItemDelete</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;orderLog:create&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">orderLogCreate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;orderLog:read&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">orderLogRead</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;orderLog:update&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">orderLogUpdate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;orderLog:delete&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">orderLogDelete</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;users:create&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">usersCreate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;users:read&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">usersRead</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;users:update&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">usersUpdate</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;users:delete&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">usersDelete</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;translateJSON&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">translateJSON</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&quot;translateArray&quot;</span><span class="hl-1">, </span><span class="hl-4">routes</span><span class="hl-1">.</span><span class="hl-4">translateArray</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:socket-io-backend"><span>Socket IO <wbr/>Backend</span></a><ul><li><a href="#md:preface"><span>Preface</span></a></li><li><a href="#md:server-setup"><span>Server setup</span></a></li><li><a href="#md:sending-data-to-the-server"><span>Sending data to the server</span></a></li><li><a href="#md:to-listen-to-updates-on-the-database-and-update-locally"><span>To listen to updates on the database and update locally</span></a></li><li><a href="#md:example-code"><span>Example <wbr/>Code</span></a></li><li><a href="#md:clarifying-stuff-up"><span>Clarifying stuff up</span></a></li><li><a href="#md:refrence"><span>Refrence</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>back</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>